version: 2.1
jobs:
    build:
        docker:
            - image: klakegg/hugo
        working_directory: ~/build
        steps:
            - checkout
            - run: 'sudo apt update'
            - run: 'sudo apt -y install snapd'
            - run: 'sudo snap install --classic go'
            - run: 'hugo --ignoreCache=true --minify --verbose'
            - persist_to_workspace:
                root: .
                paths:
                    - public
    deploy:
        docker:
            - image: klakegg/hugo
        working_directory: ~/build
        steps:
            - checkout
            - attach_workspace:
                at: ~/build
            - run: 'git config --global user.email $GH_EMAIL'
            - run: 'git config --global user.name $GH_NAME'
            - run: 'ls'
            - run: 'cd public'
            - run: 'mkdir remote'
            - run: 'cd remote'
            - run: 'git clone https://github.com/tfjmp/tfjmp.github.io'
workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build
